<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Troubleshooting Assistant</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f6f9; color: #333; }
    h2 { color: #2c3e50; }
    .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .question { margin: 20px 0; padding: 15px; background: #ecf0f1; border-radius: 6px; }
    button { margin: 5px; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { opacity: 0.9; }
    .option { background: #3498db; color: white; }
    .reset-btn { background: #e74c3c; color: white; }
    .back-btn { background: #f39c12; color: white; }
    textarea { width: 100%; height: 150px; margin-top: 20px; }
    .hidden { display: none; }
    label { display: block; margin: 10px 0 5px; }
    input { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; }
  </style>
</head>
<body>

<div class="container" id="landing">
  <h2>🔐 Customer Information</h2>
  <label>Username</label>
  <input type="text" id="usernameInput" placeholder="Enter your username" required>
  <label>Customer Name</label>
  <input type="text" id="customerNameInput" placeholder="Enter customer name" required>
  <label>Landline Number</label>
  <input type="text" id="landlineInput" placeholder="Enter landline number" required>
  <label>Mobile Number</label>
  <input type="text" id="mobileInput" placeholder="Enter mobile number" required>
  <button class="option" onclick="startFlow()">Start Troubleshooting</button>
</div>

<div class="container hidden" id="flowPage">
  <h2>🛠 Troubleshooting Steps</h2>
  <div id="questionContainer"></div>
  <button class="reset-btn" onclick="resetFlow()">Reset Flow</button>
  <button class="back-btn" onclick="backToMain()">Back to Main Page</button>
  <h3>📋 Logs</h3>
  <textarea id="logBox" readonly></textarea>
</div>

<script>
let sessionData = {};
let answers = {};
let logs = [];

// بدء الفلو بعد إدخال البيانات
function startFlow() {
  const username = document.getElementById("usernameInput").value.trim();
  const customerName = document.getElementById("customerNameInput").value.trim();
  const landline = document.getElementById("landlineInput").value.trim();
  const mobile = document.getElementById("mobileInput").value.trim();

  if (!username || !customerName || !landline || !mobile) {
    alert("⚠️ Please fill in all fields before proceeding.");
    return;
  }

  sessionData = { username, customerName, landline, mobile };
  logs = [
    `👤 Username: ${username}`,
    `📛 Customer: ${customerName}`,
    `☎️ Landline: ${landline}`,
    `📱 Mobile: ${mobile}`,
    "------------------------"
  ];

  document.getElementById("landing").classList.add("hidden");
  document.getElementById("flowPage").classList.remove("hidden");
  showQuestion("q1");
  updateLogBox();
}

// رجوع للصفحة الرئيسية
function backToMain() {
  answers = {};
  sessionData = {};
  logs = [];
  document.getElementById("flowPage").classList.add("hidden");
  document.getElementById("landing").classList.remove("hidden");
  document.getElementById("usernameInput").value = "";
  document.getElementById("customerNameInput").value = "";
  document.getElementById("landlineInput").value = "";
  document.getElementById("mobileInput").value = "";
  document.getElementById("logBox").value = "";
}

// عرض سؤال
function showQuestion(id) {
  const container = document.getElementById("questionContainer");
  container.innerHTML = "";

  const questionMap = {
    q1: {
      text: "Can you check the service on another device?",
      options: [
        { text: "✅ Problem Solved", next: "end" },
        { text: "❌ Problem the Same", next: "q2" },
        { text: "⚠️ Another device not available", next: "q2" }
      ]
    },
    q2: {
      text: "Can you ping Google Domain using HDM?",
      options: [
        { text: "✅ Replay", next: "end" },
        { text: "❌ No Replay", next: "q3" }
      ]
    },
    q3: {
      text: "Did you check TCP/IP settings?",
      options: [
        { text: "✅ Problem Solved", next: "end" },
        { text: "❌ Problem the Same", next: "escalate" }
      ]
    }
  };

  const q = questionMap[id];
  if (!q) return;

  const qDiv = document.createElement("div");
  qDiv.className = "question";
  qDiv.innerHTML = `<p><b>${q.text}</b></p>`;

  q.options.forEach(opt => {
    const btn = document.createElement("button");
    btn.className = "option";
    btn.textContent = opt.text;
    btn.onclick = () => handleAnswer(id, opt.text, opt.next);
    qDiv.appendChild(btn);
  });

  const resetBtn = document.createElement("button");
  resetBtn.className = "reset-btn";
  resetBtn.textContent = "Reset Answer";
  resetBtn.onclick = () => resetAnswer(id);
  qDiv.appendChild(resetBtn);

  container.appendChild(qDiv);

  if (answers[id]) {
    logs.push(`🔄 Updated Answer for ${id}: ${answers[id]}`);
    updateLogBox();
  }
}

// التعامل مع الإجابة
function handleAnswer(id, answer, next) {
  answers[id] = answer;
  logs.push(`${id} → ${answer}`);
  updateLogBox();

  if (next === "end") {
    const container = document.getElementById("questionContainer");
    const solvedStep = document.createElement("div");
    solvedStep.className = "question";
    solvedStep.innerHTML = "<p>🎉 Problem Solved! ✅</p>";
    container.appendChild(solvedStep);
    logs.push("🎉 Final Step: Problem Solved");
    updateLogBox();
  } else if (next === "escalate") {
    const container = document.getElementById("questionContainer");
    const escalateStep = document.createElement("div");
    escalateStep.className = "question";
    escalateStep.innerHTML = "<p>⚠️ Please escalate the issue 🚀</p>";
    container.appendChild(escalateStep);
    logs.push("⚠️ Final Step: Escalation Required");
    updateLogBox();
  } else {
    showQuestion(next);
  }
}

// Reset الإجابة فقط
function resetAnswer(id) {
  if (answers[id]) {
    logs.push(`♻️ Reset Answer for ${id}`);
    delete answers[id];
    updateLogBox();
    showQuestion(id);
  }
}

// Reset الفلو كله
function resetFlow() {
  answers = {};
  logs.push("♻️ Flow Reset");
  updateLogBox();
  showQuestion("q1");
}

// تحديث اللوجز
function updateLogBox() {
  document.getElementById("logBox").value = logs.join("\n");
}

/* ---------------- 🔒 الحماية ---------------- */

// منع الكليك يمين
document.addEventListener("contextmenu", e => {
  e.preventDefault();
  alert("🚫 Right-click disabled.");
});

// منع بعض الاختصارات
document.onkeydown = function(e) {
  if (e.keyCode == 123) { e.preventDefault(); return false; } // F12
  if (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74 || e.keyCode == 67)) {
    e.preventDefault(); return false; // Ctrl+Shift+I/J/C
  }
  if (e.ctrlKey && e.keyCode == 85) { e.preventDefault(); return false; } // Ctrl+U
};

// رجوع للصفحة الرئيسية عند محاولة فتح DevTools
function forceLogout() {
  alert("⚠️ Developer Tools detected. Returning to main page.");
  backToMain();
}

// مراقبة console.log (محاولة فتح DevTools)
(function() {
  const element = new Image();
  Object.defineProperty(element, 'id', {
    get: function () {
      forceLogout();
    }
  });
  console.log(element);
})();
</script>

</body>
</html>